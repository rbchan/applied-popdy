\documentclass[12pt]{article}\usepackage[]{graphicx}\usepackage[]{xcolor}
% maxwidth is the original width if it is less than linewidth
% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlsng}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hldef}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}

%\usepackage[roman]{../pres1}
%\usepackage[sans]{../pres1}

\usepackage[hmargin=1in,vmargin=1in]{geometry}
\usepackage{parskip}
\usepackage{hyperref}
\usepackage{graphicx}
\hypersetup{pdfstartview=FitV,hidelinks}




\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}

{
  \Large
  \centering
  Lab 7 Assignment --- Age-structured Models \\
  Due by 8:00am on Monday \par
}

\vspace{12pt}

Answer each of the following questions and upload your Excel file and
R script (graduate students only) to ELC. Be sure to show your
calculations. Undergraduates will get 20 bonus points for doing the entire 
lab in Excel and R. \\ 

\section*{Exercises}

%\vspace{12pt}

{\bf Exercise I \\}
Imagine a population with 4 age classes. The fecundities are $f_1=0$,
$f_2=1.0$, $f_3=1.5$, and $f_4=1.2$. The survival probabilities are
$s_1=0.8$, $s_2=0.5$, $s_3=0.25$, and $s_4=0.0$. The initial
population sizes are $n_{1,1}=45$, $n_{2,1}=18$, $n_{3,1}=11$, $n_{4,1}=4$.
\begin{itemize}
  \item[(a)] Create a Leslie matrix with the vital rates provided above.
  \item[(b)] Project the population forward 25 years and plot abundance for
    each age class and for the total population size. (Graduate students
    only: Do the projection using matrix multiplication in {\tt R} with
    the \texttt{\%*\%} operator. See the end of this document for
    guidance.)
  \item[(c)] Create another plot of abundance for each age class, but use the
    logarithmic scale for the y-axis. This can be done by right-clicking
    on the y-axis and selecting ``Format axis''. Choose the logarithmic
    axis option with base=10.
  \item[(d)] Calculate and plot the age-specific
    growth rates: $\lambda_{i,t}$. What is the asymptotic growth rate
    ($\lambda$), rounded to 4 decimals places?
  \item[(e)] What is the stable age distribution?
  \item[(f)] Graduate students only: Compute asymptotic $\lambda$ and
    the stable age distribution using the \texttt{eigen} function in {\tt R}.
  % \item[(f)] What happens to the estimates of $\lambda$ if you change the
  %   initial population sizes to: $n_{1,0}=75$, $n_{2,0}=1$, $n_{3,0}=1$,
  %   $n_{4,0}=1$. Explain.
\end{itemize}



\vspace{12pt}

\clearpage

{\bf Exercise II \\}

Reproductive value (RV) can be used to identify the age class that
contributes the most to population growth. The inoculate method is a
way of computing RV by doing one projection for each of the age
classes.

For each projection, use a population size of 200 individuals, and put
all individuals in one of the four age classes. For example, one
projection will have $n_{1,1}=200$, $n_{2,1}=0$, $n_{3,1}=0$, $n_{4,1}=0$. The next
projection will have all 200 individuals in the next age class, and so
on. For each projection, record the total population size after 50
time steps. Reproductive value is calculated by dividing each
projection's total population size ($N_t$) at $t=50$ by the total population
size from the first projection. (As a result, RV will always be 1 for
the first age class when using this method).

\begin{itemize}
  \item[(a)] Given the following Leslie matrix, calculate the RV of each
    age class using the inoculate method.
  \item[(b)] If you were charged with reintroducing this species back
    into the wild, and you could only reintroduce one age class, which
    one would you release to maximize population growth? Why is
    reproductive value so high for this age class?
  \item[(c)] Graduate students only: Compute reproductive value using
    the \texttt{eigen} function.
\end{itemize}

%Leslie Matrix
\begin{table}[h]
  \centering
  \caption{Leslie Matrix}
  \begin{tabular}{cccc}
%    \hline
%    Age class 1 & Age class 2 & Age class 3 & Age class 4 \\
    \hline
    1.6 & 1.5 & 0.25 & 0 \\
    0.8 & 0   & 0    & 0 \\
    0   & 0.5 & 0    & 0 \\
    0   & 0   & 0.25 & 0 \\
    \hline
  \end{tabular}
  \label{tab:A}
\end{table}



\clearpage

\section*{Age-structured models in {\tt R}}

This is an example of an age-structured model with 3 age classes. It
is just an example -- the parameter values are different than the ones
in the assignment above.

First, create the projection matrix.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{A} \hlkwb{<-} \hlkwd{matrix}\hldef{(}\hlkwd{c}\hldef{(}\hlnum{0.0}\hldef{,} \hlnum{1.5}\hldef{,} \hlnum{0.5}\hldef{,}  \hlcom{## The fecundities}
              \hlnum{0.5}\hldef{,} \hlnum{0.0}\hldef{,} \hlnum{0.0}\hldef{,}  \hlcom{## The first value is s1}
              \hlnum{0.0}\hldef{,} \hlnum{0.9}\hldef{,} \hlnum{0.0}\hldef{),} \hlcom{## The second value is s2}
            \hlkwc{nrow}\hldef{=}\hlnum{3}\hldef{,} \hlkwc{ncol}\hldef{=}\hlnum{3}\hldef{,} \hlkwc{byrow}\hldef{=}\hlnum{TRUE}\hldef{)}
\hldef{A}
\end{alltt}
\begin{verbatim}
##      [,1] [,2] [,3]
## [1,]  0.0  1.5  0.5
## [2,]  0.5  0.0  0.0
## [3,]  0.0  0.9  0.0
\end{verbatim}
\end{kframe}
\end{knitrout}


Set values of initial abundance and prepare to project over 50 years.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{years} \hlkwb{<-} \hlnum{1}\hlopt{:}\hlnum{50}
\hldef{nYears} \hlkwb{<-} \hlkwd{length}\hldef{(years)}
\hldef{n} \hlkwb{<-} \hlkwd{matrix}\hldef{(}\hlnum{NA}\hldef{, nYears,} \hlnum{3}\hldef{)}
\hldef{n[}\hlnum{1}\hldef{,]} \hlkwb{<-} \hlkwd{c}\hldef{(}\hlnum{100}\hldef{,} \hlnum{50}\hldef{,} \hlnum{25}\hldef{)}    \hlcom{## Initial abundance}
\end{alltt}
\end{kframe}
\end{knitrout}


Do the projection.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwa{for}\hldef{(t} \hlkwa{in} \hlnum{2}\hlopt{:}\hldef{nYears) \{}
  \hldef{n[t,]} \hlkwb{<-} \hldef{A} \hlopt{%*%} \hldef{n[t}\hlopt{-}\hlnum{1}\hldef{,]}   \hlcom{## Matrix multiplication}
\hldef{\}}
\end{alltt}
\end{kframe}
\end{knitrout}

\clearpage


Visualize it.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{matplot}\hldef{(years, n,} \hlkwc{type}\hldef{=}\hlsng{"o"}\hldef{,} \hlkwc{pch}\hldef{=}\hlnum{16}\hldef{,} \hlkwc{xlab}\hldef{=}\hlsng{"Time"}\hldef{,} \hlkwc{ylab}\hldef{=}\hlsng{"Abundance"}\hldef{)}
\hlkwd{legend}\hldef{(}\hlnum{35}\hldef{,} \hlnum{100}\hldef{,} \hlkwd{c}\hldef{(}\hlsng{"Age class 1"}\hldef{,} \hlsng{"Age class 2"}\hldef{,} \hlsng{"Age class 3"}\hldef{),}
       \hlkwc{col}\hldef{=}\hlnum{1}\hlopt{:}\hlnum{3}\hldef{,} \hlkwc{pch}\hldef{=}\hlnum{16}\hldef{,} \hlkwc{lty}\hldef{=}\hlnum{1}\hldef{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=0.85\textwidth]{figure/ex1-plot-1} 

}


\end{knitrout}

\clearpage

Compute the age distribution and take a look.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{N} \hlkwb{<-} \hlkwd{rowSums}\hldef{(n)} \hlcom{## Total abundance each year}
\hldef{c} \hlkwb{<-} \hldef{n}\hlopt{/}\hldef{N}        \hlcom{## This works because of R's recycling rules}
\hlkwd{matplot}\hldef{(years, c,} \hlkwc{type}\hldef{=}\hlsng{"o"}\hldef{,} \hlkwc{pch}\hldef{=}\hlnum{16}\hldef{,} \hlkwc{ylim}\hldef{=}\hlkwd{c}\hldef{(}\hlnum{0}\hldef{,} \hlnum{1}\hldef{),} \hlkwc{xlab}\hldef{=}\hlsng{"Time"}\hldef{,}
        \hlkwc{ylab}\hldef{=}\hlsng{"Proportion in each age class"}\hldef{)}
\hlkwd{legend}\hldef{(}\hlnum{35}\hldef{,} \hlnum{1}\hldef{,} \hlkwd{c}\hldef{(}\hlsng{"Age class 1"}\hldef{,} \hlsng{"Age class 2"}\hldef{,} \hlsng{"Age class 3"}\hldef{),}
       \hlkwc{col}\hldef{=}\hlnum{1}\hlopt{:}\hlnum{3}\hldef{,} \hlkwc{pch}\hldef{=}\hlnum{16}\hldef{,} \hlkwc{lty}\hldef{=}\hlnum{1}\hldef{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=0.85\textwidth]{figure/ex1-AD-1} 

}


\end{knitrout}

Grab the stable age distribution from the final year.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{SAD.proj} \hlkwb{<-} \hldef{c[nYears,]}
\hldef{SAD.proj}
\end{alltt}
\begin{verbatim}
## [1] 0.508639 0.257221 0.234140
\end{verbatim}
\end{kframe}
\end{knitrout}


\clearpage

Now compute the annual growth rates for each age class and plot them.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{lambda.it} \hlkwb{<-} \hldef{n[}\hlopt{-}\hlnum{1}\hldef{,]}\hlopt{/}\hldef{n[}\hlopt{-}\hldef{nYears,]} \hlcom{## Divide each row by the row before it}
\hlkwd{matplot}\hldef{(years[}\hlopt{-}\hlnum{1}\hldef{],} \hlcom{## There are nYears-1 *intervals* between years}
        \hldef{lambda.it,} \hlkwc{type}\hldef{=}\hlsng{"o"}\hldef{,} \hlkwc{pch}\hldef{=}\hlnum{16}\hldef{,} \hlkwc{xlab}\hldef{=}\hlsng{"Time"}\hldef{,} \hlkwc{ylab}\hldef{=}\hlsng{"Growth rates"}\hldef{)}
\hlkwd{abline}\hldef{(}\hlkwc{h}\hldef{=}\hlnum{1}\hldef{,} \hlkwc{lty}\hldef{=}\hlnum{2}\hldef{,} \hlkwc{col}\hldef{=}\hlsng{"grey"}\hldef{)} \hlcom{## Horizontal line}
\hlkwd{legend}\hldef{(}\hlnum{35}\hldef{,} \hlnum{1.8}\hldef{,} \hlkwd{c}\hldef{(}\hlsng{"Age class 1"}\hldef{,} \hlsng{"Age class 2"}\hldef{,} \hlsng{"Age class 3"}\hldef{),}
       \hlkwc{col}\hldef{=}\hlnum{1}\hlopt{:}\hlnum{3}\hldef{,} \hlkwc{pch}\hldef{=}\hlnum{16}\hldef{,} \hlkwc{lty}\hldef{=}\hlnum{1}\hldef{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=0.85\textwidth]{figure/ex1-lam_it-1} 

}


\end{knitrout}

Find asymptotic $\lambda$ from the last time interval.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{lambda.it[nYears}\hlopt{-}\hlnum{1}\hldef{,]} \hlcom{## These should all be the same}
\end{alltt}
\begin{verbatim}
## [1] 0.9887199 0.9887199 0.9887199
\end{verbatim}
\begin{alltt}
\hldef{lambda.proj} \hlkwb{<-} \hldef{lambda.it[nYears}\hlopt{-}\hlnum{1}\hldef{,}\hlnum{1}\hldef{]}
\hldef{lambda.proj} \hlcom{## Asymptotic growth rate}
\end{alltt}
\begin{verbatim}
## [1] 0.9887199
\end{verbatim}
\end{kframe}
\end{knitrout}

\clearpage

Now we will use eigenanalysis to compute the growth rate, stable age
distribution, and reproductive value.

First compute $\lambda$.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{eA} \hlkwb{<-} \hlkwd{eigen}\hldef{(A)}
\hldef{lambda} \hlkwb{<-} \hlkwd{Re}\hldef{(eA}\hlopt{$}\hldef{values[}\hlnum{1}\hldef{])}  \hlcom{## Dominant eigenvalue is the }
\hldef{lambda}                      \hlcom{## asymptotic growth rate}
\end{alltt}
\begin{verbatim}
## [1] 0.9887199
\end{verbatim}
\end{kframe}
\end{knitrout}

Make sure it's the same growth rate that we found earlier.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{lambda.proj}
\end{alltt}
\begin{verbatim}
## [1] 0.9887199
\end{verbatim}
\begin{alltt}
\hldef{lambda}
\end{alltt}
\begin{verbatim}
## [1] 0.9887199
\end{verbatim}
\end{kframe}
\end{knitrout}


Now find the stable age distribution.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{SADu} \hlkwb{<-} \hlkwd{Re}\hldef{(eA}\hlopt{$}\hldef{vectors[,}\hlnum{1}\hldef{])}  \hlcom{## Right eigenvector is stable age dist}
\hldef{SAD} \hlkwb{<-} \hldef{SADu}\hlopt{/}\hlkwd{sum}\hldef{(SADu)}
\hldef{SAD}
\end{alltt}
\begin{verbatim}
## [1] 0.508639 0.257221 0.234140
\end{verbatim}
\end{kframe}
\end{knitrout}

Check to make sure that the stable age distribution computed using
eigenanalysis is equal to that calculated from the projection.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{SAD}
\end{alltt}
\begin{verbatim}
## [1] 0.508639 0.257221 0.234140
\end{verbatim}
\begin{alltt}
\hldef{SAD.proj}
\end{alltt}
\begin{verbatim}
## [1] 0.508639 0.257221 0.234140
\end{verbatim}
\end{kframe}
\end{knitrout}



Now compute the reproductive value (RV) of each age class.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hldef{eAT} \hlkwb{<-} \hlkwd{eigen}\hldef{(}\hlkwd{t}\hldef{(A))}
\hldef{RVu} \hlkwb{<-} \hlkwd{Re}\hldef{(eAT}\hlopt{$}\hldef{vectors[,}\hlnum{1}\hldef{])} \hlcom{## Left eigenvector gives the RVs}
\hldef{RV} \hlkwb{<-} \hldef{RVu}\hlopt{/}\hldef{RVu[}\hlnum{1}\hldef{]}           \hlcom{## Standard to divide by first RV}
\hldef{RV}
\end{alltt}
\begin{verbatim}
## [1] 1.0000000 1.9774397 0.5057044
\end{verbatim}
\end{kframe}
\end{knitrout}




\end{document}
